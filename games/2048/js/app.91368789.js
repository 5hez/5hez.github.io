(function(e){function t(t){for(var i,a,c=t[0],s=t[1],u=t[2],d=0,v=[];d<c.length;d++)a=c[d],r[a]&&v.push(r[a][0]),r[a]=0;for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i]);l&&l(t);while(v.length)v.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],i=!0,c=1;c<n.length;c++){var s=n[c];0!==r[s]&&(i=!1)}i&&(o.splice(t--,1),e=a(a.s=n[0]))}return e}var i={},r={app:0},o=[];function a(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=i,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/games/2048/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var l=s;o.push(["b8ef","chunk-vendors"]),n()})({"7f72":function(e,t,n){"use strict";var i=n("f651"),r=n.n(i);r.a},a40c:function(e,t,n){"use strict";var i=n("d658"),r=n.n(i);r.a},b8ef:function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("097d"),n("5cfb");var i=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("div",{staticClass:"content"},[n("div",{staticClass:"name"},[e._v("2048")]),n("div",{staticClass:"menu"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.data.dimension,expression:"data.dimension"}],staticClass:"dimension",attrs:{type:"number"},domProps:{value:e.data.dimension},on:{input:function(t){t.target.composing||e.$set(e.data,"dimension",t.target.value)}}}),n("div",{staticClass:"btn",on:{click:e.restart}},[e._v("new game")])])]),n("div",{ref:"box",staticClass:"box",attrs:{id:"box"}},[n("div",{attrs:{id:"pixi"}})]),n("game-over",{directives:[{name:"show",rawName:"v-show",value:e.data.isGameOver,expression:"data.isGameOver"}]})],1)},o=[],a=n("c8b5"),c=n.n(a);function s(e){var t=new c.a.Manager(e);return t.add(new c.a.Swipe),t}var u=n("be94"),l=(n("7514"),n("ac6a"),n("6c7b"),n("2ef0")),d=n.n(l),v=n("22a2"),f={};function p(){f.dimension=4,f.margin=6,f.speed=10,f.currentScore=0,f.highestScore=0,f.isGameOver=!1}p();var h=f;function y(e,t){var n,i,r,o,a;return n=!1,e.centerX=e.x+e.width/2,e.centerY=e.y+e.height/2,t.centerX=t.x+t.width/2,t.centerY=t.y+t.height/2,e.halfWidth=e.width/2,e.halfHeight=e.height/2,t.halfWidth=t.width/2,t.halfHeight=t.height/2,o=e.centerX-t.centerX,a=e.centerY-t.centerY,i=e.halfWidth+t.halfWidth,r=e.halfHeight+t.halfHeight,n=Math.abs(o)<i&&Math.abs(a)<r,n}function g(e){var t={};return t.code=e,t.release=void 0,t.upHandler=function(e){e.keyCode===t.code&&t.release&&t.release(),e.preventDefault()},window.addEventListener("keyup",t.upHandler.bind(t),!1),t}function m(e,t){return Math.floor(Math.random()*(t-e+1))+e}function x(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;return+parseFloat(e.toPrecision(t))}function w(e,t){return{y:_.floor(e/t),x:e%t}}var b=h.dimension,S=h.margin,C=h.speed,W=0,M=new v["a"]({width:W,height:W}),O={isInitRandomSprite:!1,isMoving:!1,spriteWidth:x(W/b-2*S),probability:90,sprites:[],mergeSprites:[],textures:[],chessBgStage:[],moveDirection:0,moveSteps:[],rectContainer:null,spriteContainer:null,isReserve:!1,left:g(37),up:g(38),right:g(39),down:g(40),moveSprite:q,initView:j,drawRectSprite:H},R={initView:j};function B(){p(),W=.9*h.width;var e=b;O.spriteWidth=x(W/e-2*S),h.speed=x(O.spriteWidth+h.margin),O.isInitRandomSprite=!1,O.isReserve=!1,O.moveSteps=[],O.moveDirection=0,O.chessBgStage=d.a.fill(Array(e*e),0,0,e*e)}function j(){B(),M=new v["a"]({width:W,height:W}),document.getElementById("pixi").replaceWith(M.view),M.renderer.view.id="pixi",M.renderer.backgroundColor=12299680,M.renderer.view.style.margin=0,M.renderer.view.style.padding=0,M.renderer.view.style.verticalAlign="top",O.rectContainer=new v["b"],O.spriteContainer=new v["b"],M.loader.add([{name:"numberJson",url:"/game-img/2048/number.json"}]).on("progress",N).load(function(){k(),E(),M.ticker.add(J)})}function E(){D(O.chessBgStage),z(),X(),O.isInitRandomSprite=!1,X()}function k(){O.textures=M.loader.resources["numberJson"].textures}function D(e){e.forEach(function(e,t){I(w(t,b))}),M.stage.addChild(O.rectContainer),M.stage.addChild(O.spriteContainer),O.sprites=M.stage.children[1].children}function I(e){var t=e.x,n=e.y,i=new v["c"],r=x(S+(O.spriteWidth+2*S)*t),o=x(S+(O.spriteWidth+2*S)*n);i.beginFill(13418675),i.drawRoundedRect(r,o,O.spriteWidth,O.spriteWidth,20),i.endFill(),O.rectContainer.addChild(i)}function H(e){var t=e.x,n=e.y,i=e.value,r=x(S+(O.spriteWidth+2*S)*t),o=x(S+(O.spriteWidth+2*S)*n);G({x:r,y:o,value:i})}function G(e){var t=e.x,n=e.y,i=e.value,r=e.v,o=void 0===r?{vx:0,vy:0}:r,a=new v["d"](O.textures["n".concat(i,".png")]);a.x=x(t),a.vx=o.vx,a.vy=o.vy,a.y=x(n),a.value=i,a.isNew=!0,a.width=O.spriteWidth,a.height=O.spriteWidth,a.aid=d.a.uniqueId(),O.spriteContainer.addChild(a)}function N(e,t){console.log("loading: "+t.url),console.log("progress: "+e.progress+"%")}function P(e,t){var n=d.a.sortBy(O.sprites.filter(function(e){return e.y===t}),[function(e){return-e.x}]).find(function(t){return t.x<e});return n?!n.hasHitSprite&&n:n}function A(e,t){var n=d.a.sortBy(O.sprites.filter(function(e){return e.y===t}),[function(e){return e.x}]).find(function(t){return t.x>e});return n?!n.hasHitSprite&&n:n}function F(e,t){var n=d.a.sortBy(O.sprites.filter(function(t){return t.x===e}),[function(e){return-e.y}]).find(function(e){return e.y<t});return n?!n.hasHitSprite&&n:n}function V(e,t){var n=d.a.sortBy(O.sprites.filter(function(t){return t.x===e}),[function(e){return e.y}]).find(function(e){return e.y>t});return n?!n.hasHitSprite&&n:n}function J(){O.sprites.every(function(e){return 0===e.vx&&0===e.vy})&&(O.isMoving=!1,O.sprites.every(function(e){return Math.abs(e.x-e.x1)<1&&Math.abs(e.y-e.y1)<1})||(X(),T()&&(h.isGameOver=!0)));var e=x(W-O.spriteWidth-S);O.sprites.forEach(function(t,n){t.x1=t.x,t.y1=t.y,t.x+=t.vx,t.y+=t.vy;var i=null;2===O.moveDirection&&(i=P(t.x,t.y)),4===O.moveDirection&&(i=A(t.x,t.y)),8===O.moveDirection&&(i=F(t.x,t.y)),16===O.moveDirection&&(i=V(t.x,t.y)),i?y(t,i)&&(t.value!==i.value||i.isNew||t.isNew||!(t.vx&&!i.vx||t.vy&&!i.vy)?(2===O.moveDirection&&(t.x=x(i.x+O.spriteWidth+2*S),t.vx=i.vx),4===O.moveDirection&&(t.x=x(i.x-O.spriteWidth-2*S),t.vx=i.vx),8===O.moveDirection&&(t.y=x(i.y+O.spriteWidth+2*S),t.vy=i.vy),16===O.moveDirection&&(t.y=x(i.y-O.spriteWidth-2*S),t.vy=i.vy)):(console.log("will be push in hitMerge arr s1:".concat(t.aid,", x: ").concat(t.x,", y: ").concat(t.y,", value: ").concat(t.value,", vx: ").concat(t.vx,", vy: ").concat(t.vy)),console.log("will be push in hitMerge arr s2:".concat(i.aid,", x: ").concat(i.x,", y: ").concat(i.y,", value: ").concat(i.value,", vx: ").concat(i.vx,", vy: ").concat(i.vy)),t.hasHitSprite=!0,O.mergeSprites.push({s1:t,s2:i}))):(t.x<S&&(t.x=S,t.vx=0),t.x>e&&(t.x=e,t.vx=0),t.y>e&&(t.y=e,t.vy=0),t.y<S&&(t.y=S,t.vy=0))}),O.mergeSprites.forEach(function(e){console.log("foreach hitMerge arr s1:".concat(e.s1.aid,", x: ").concat(e.s1.x,", y: ").concat(e.s1.y,", value: ").concat(e.s1.value)),console.log("foreach hitMerge arr s2:".concat(e.s2.aid,", x: ").concat(e.s2.x,", y: ").concat(e.s2.y,", value: ").concat(e.s2.value)),L(e.s1,e.s2)}),O.mergeSprites=[]}function X(){if(!O.isInitRandomSprite){O.isInitRandomSprite=!0,console.log("数组长度：".concat(O.sprites.length));var e=m(0,b*b-1);O.randomSpriteIndex=e,console.log("初始随机位置：".concat(e)),e=Y(e),console.log("去重后随机位置：".concat(e));var t=m(0,100)>O.probability?4:2;O.drawRectSprite(Object(u["a"])({},w(e,b),{value:t}))}}function Y(e){var t=$(e);return console.log("是否位置重叠：".concat(t)),t?(e+=1,e%=b*b,Y(e)):e}function $(e){var t=w(e,b),n=t.x,i=t.y;console.log("随机位置对应的x：".concat(n,", y: ").concat(i));var r=x(S+(O.spriteWidth+2*S)*n),o=x(S+(O.spriteWidth+2*S)*i);return O.sprites.find(function(e){return Math.abs(e.x-r)<1&&Math.abs(e.y-o)<1})}function T(){if(O.sprites.length===b*b){var e=d.a.sortBy(O.sprites,["y","x"]),t=e.find(function(t,n){return!!e[n+1]&&(t.y===e[n+1].y&&t.value===e[n+1].value)});return t||(e=d.a.sortBy(O.sprites,["x","y"]),t=e.find(function(t,n){return!!e[n+1]&&(t.x===e[n+1].x&&t.value===e[n+1].value)})),!t}return!1}function q(e){O.isMoving||(O.isMoving=!0,O.isInitRandomSprite=!1,O.moveDirection=e,O.moveSteps.push(e),O.sprites.forEach(function(e){return e.isNew=!1}),console.warn("方向：".concat(e)),O.isReserve&&(2===e||8===e)||!O.isReserve&&(4===e||16===e)?(O.sprites.reverse(),O.isReserve=!0):O.isReserve=!1,O.sprites.forEach(function(t){t.isNew=!1,2===e&&(t.vx=-C),4===e&&(t.vx=C),8===e&&(t.vy=-C),16===e&&(t.vy=C)}))}function L(e,t){console.log("hitMerge-s1: aid: ".concat(e.aid,", x: ").concat(e.x,", y: ").concat(e.y,", value: ").concat(e.value)),console.log("hitMerge-s2: aid: ".concat(t.aid,", x: ").concat(t.x,", y: ").concat(t.y,", value: ").concat(t.value)),G({x:e.x,y:e.y,value:2*e.value,v:{vx:e.vx,vy:e.vy}}),e.visible=!1,t.visible=!1;var n=M.stage.children[1].removeChild(e);console.log("removeChild-s1: aid: ".concat(n&&n.aid));var i=M.stage.children[1].removeChild(t);console.log("removeChild-s2: aid: ".concat(i&&i.aid))}function z(e){s(document.getElementById("pixi")).on("swipe",function(e){q(e.offsetDirection)}),O.left.release=function(){q(2)},O.right.release=function(){q(4)},O.down.release=function(){q(16)},O.up.release=function(){q(8)}}window.pixi=O;var K=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"game-over"},[n("div",{staticClass:"text"},[e._v("game over!")]),n("div",{staticClass:"btn",on:{click:e.newGame}},[e._v("new game")])])},Q=[],U={name:"GameOver",props:{},methods:{newGame:function(){h.width=document.getElementById("app").clientWidth,R.initView()}}},Z=U,ee=(n("a40c"),n("2877")),te=Object(ee["a"])(Z,K,Q,!1,null,"72be6538",null);te.options.__file="gameover.vue";var ne=te.exports,ie={name:"Games-2048",components:{GameOver:ne},data:function(){return{data:h}},mounted:function(){h.width=document.getElementById("app").clientWidth,R.initView()},methods:{restart:function(){h.width=document.getElementById("app").clientWidth,R.initView()}}},re=ie,oe=(n("d599"),n("7f72"),Object(ee["a"])(re,r,o,!1,null,"9cbec608",null));oe.options.__file="App.vue";var ae=oe.exports,ce=n("9483");Object(ce["a"])("".concat("/games/2048/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},cached:function(){console.log("Content has been cached for offline use.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}}),i["a"].config.productionTip=!1,new i["a"]({render:function(e){return e(ae)}}).$mount("#app")},d599:function(e,t,n){"use strict";var i=n("ed80"),r=n.n(i);r.a},d658:function(e,t,n){},ed80:function(e,t,n){},f651:function(e,t,n){}});
//# sourceMappingURL=app.91368789.js.map
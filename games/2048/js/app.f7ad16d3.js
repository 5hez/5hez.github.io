(function(e){function t(t){for(var i,a,s=t[0],c=t[1],u=t[2],d=0,v=[];d<s.length;d++)a=s[d],r[a]&&v.push(r[a][0]),r[a]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);l&&l(t);while(v.length)v.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],i=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(i=!1)}i&&(o.splice(t--,1),e=a(a.s=n[0]))}return e}var i={},r={app:0},o=[];function a(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=i,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/games/2048/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=c;o.push(["b8ef","chunk-vendors"]),n()})({"7f72":function(e,t,n){"use strict";var i=n("f651"),r=n.n(i);r.a},a40c:function(e,t,n){"use strict";var i=n("d658"),r=n.n(i);r.a},b8ef:function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("097d"),n("5cfb");var i=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("div",{staticClass:"content"},[n("div",{staticClass:"name"},[e._v("2048")]),n("div",{staticClass:"menu"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.data.dimension,expression:"data.dimension"}],staticClass:"dimension",attrs:{type:"number"},domProps:{value:e.data.dimension},on:{input:function(t){t.target.composing||e.$set(e.data,"dimension",t.target.value)}}}),n("div",{staticClass:"btn",on:{click:e.restart}},[e._v("new game")])])]),n("div",{ref:"box",staticClass:"box",attrs:{id:"box"}},[n("div",{attrs:{id:"pixi"}})]),n("game-over",{directives:[{name:"show",rawName:"v-show",value:e.data.isGameOver,expression:"data.isGameOver"}]})],1)},o=[],a=n("c8b5"),s=n.n(a);function c(e){var t=new s.a.Manager(e);return t.add(new s.a.Swipe),t}n("7514");var u=n("be94"),l=(n("ac6a"),n("6c7b"),n("2ef0")),d=n.n(l),v=n("22a2"),p={};function f(){p.dimension=4,p.margin=6,p.speed=10,p.currentScore=0,p.highestScore=0,p.isGameOver=!1}f();var h=p;function m(e){var t={};return t.code=e,t.release=void 0,t.upHandler=function(e){e.keyCode===t.code&&t.release&&t.release(),e.preventDefault()},window.addEventListener("keyup",t.upHandler.bind(t),!1),t}function y(e,t){return Math.floor(Math.random()*(t-e+1))+e}function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;return+parseFloat(e.toPrecision(t))}function x(e,t){return{y:_.floor(e/t),x:e%t}}var w=h.dimension,b=h.margin,S=h.speed,C=0,M=new v["a"]({width:C,height:C}),W={isInitRandomSprite:!1,isMoving:!1,spriteWidth:g(C/w-2*b),probability:90,sprites:[],mergeSprites:[],textures:[],chessBgStage:[],moveDirection:0,moveSteps:[],rectContainer:null,spriteContainer:null,isReserve:!1,left:m(37),up:m(38),right:m(39),down:m(40),moveSprite:q,initView:D,drawRectSprite:E},O={initView:D};function R(){f(),C=.9*h.width;var e=w;W.spriteWidth=g(C/e-2*b),h.speed=g(W.spriteWidth+h.margin),W.isInitRandomSprite=!1,W.isReserve=!1,W.moveSteps=[],W.moveDirection=0,W.chessBgStage=d.a.fill(Array(e*e),0,0,e*e)}function D(){R(),M=new v["a"]({width:C,height:C}),document.getElementById("pixi").replaceWith(M.view),M.renderer.view.id="pixi",M.renderer.backgroundColor=12299680,M.renderer.view.style.margin=0,M.renderer.view.style.padding=0,M.renderer.view.style.verticalAlign="top",W.rectContainer=new v["b"],W.spriteContainer=new v["b"],M.loader.add([{name:"numberJson",url:"/game-img/2048/number.json"}]).on("progress",G).load(function(){B(),I(),M.ticker.add(F)})}function I(){j(W.chessBgStage),L(),V(),W.isInitRandomSprite=!1,V(),W.isInitRandomSprite=!1,V(),W.isInitRandomSprite=!1,V(),W.isInitRandomSprite=!1,V()}function B(){W.textures=M.loader.resources["numberJson"].textures}function j(e){e.forEach(function(e,t){k(x(t,w))}),M.stage.addChild(W.rectContainer),M.stage.addChild(W.spriteContainer),W.sprites=M.stage.children[1].children}function k(e){var t=e.x,n=e.y,i=new v["c"],r=g(b+(W.spriteWidth+2*b)*t),o=g(b+(W.spriteWidth+2*b)*n);i.beginFill(13418675),i.drawRoundedRect(r,o,W.spriteWidth,W.spriteWidth,20),i.endFill(),W.rectContainer.addChild(i)}function E(e){var t=e.x,n=e.y,i=e.value,r=g(b+(W.spriteWidth+2*b)*t),o=g(b+(W.spriteWidth+2*b)*n);N({x:r,y:o,value:i})}function N(e){var t=e.x,n=e.y,i=e.value,r=e.v,o=void 0===r?{vx:0,vy:0}:r,a=new v["d"](W.textures["n".concat(i,".png")]);a.x=g(t),a.x1=2*a.x,a.vx=o.vx,a.vy=o.vy,a.y=g(n),a.y1=2*a.y,a.value=i,a.isNew=!0,a.width=W.spriteWidth,a.height=W.spriteWidth,a.aid=d.a.uniqueId(),W.spriteContainer.addChild(a)}function G(e,t){console.log("loading: "+t.url),console.log("progress: "+e.progress+"%")}function P(e,t){for(var n=[[e[0]]],i=1;i<e.length;i++){if(!e[i])break;d.a.last(d.a.last(n))[t]!==e[i][t]?n.push([e[i]]):d.a.last(n).push(e[i])}return n}function A(e){if(2===e){var t=d.a.sortBy(W.sprites,["y","x"]);return P(t,"y")}if(4===e){var n=d.a.sortBy(W.sprites,["y",function(e){return-e.x}]);return P(n,"y")}if(8===e){var i=d.a.sortBy(W.sprites,["x","y"]);return P(i,"x")}if(16===e){var r=d.a.sortBy(W.sprites,["x",function(e){return-e.y}]);return P(r,"x")}}function F(){if(W.sprites.every(function(e){return 0===e.vx&&0===e.vy}))return W.isMoving=!1,void(W.sprites.every(function(e){return Math.abs(e.x-e.x1)<1&&Math.abs(e.y-e.y1)<1})||(V(),T()&&(h.isGameOver=!0)));var e=g(C-W.spriteWidth-b),t=W.spriteWidth+b,n=2*b+5*W.spriteWidth/4;A(W.moveDirection).forEach(function(i){for(var r=0;r<i.length;r++){var o=i[r];if(2===W.moveDirection&&o.x<=b)o.x=b,o.vx=0;else if(4===W.moveDirection&&o.x>=e)o.x=e,o.vx=0;else if(16===W.moveDirection&&o.y>=e)o.y=e,o.vy=0;else if(8===W.moveDirection&&o.y<=b)o.y=b,o.vy=0;else{var a=i[r-1];if(a){var s=Math.abs(o.x-a.x)>=t&&Math.abs(o.x-a.x)<=n||Math.abs(o.y-a.y)>=t&&Math.abs(o.y-a.y)<=n;if(!a.vx&&!a.vy&&s&&(o.value!==a.value||a.isNew||o.isNew)){2===W.moveDirection&&(o.x=g(a.x+W.spriteWidth+2*b),o.vx=0),4===W.moveDirection&&(o.x=g(a.x-W.spriteWidth-2*b),o.vx=0),8===W.moveDirection&&(o.y=g(a.y+W.spriteWidth+2*b),o.vy=0),16===W.moveDirection&&(o.y=g(a.y-W.spriteWidth-2*b),o.vy=0);continue}var c=(2===W.moveDirection||4===W.moveDirection)&&Math.abs(a.x-o.x)<=S||(8===W.moveDirection||16===W.moveDirection)&&Math.abs(a.y-o.y)<=S;a.value!==o.value||!c||a.isNew||o.isNew||(console.log("will be push in hitMerge arr s1:".concat(o.aid,", x: ").concat(o.x,", y: ").concat(o.y,", value: ").concat(o.value,", vx: ").concat(o.vx,", vy: ").concat(o.vy)),console.log("will be push in hitMerge arr s2:".concat(a.aid,", x: ").concat(a.x,", y: ").concat(a.y,", value: ").concat(a.value,", vx: ").concat(a.vx,", vy: ").concat(a.vy)),W.mergeSprites.push({s1:o,s2:a}))}o.x+=o.vx,o.y+=o.vy}}}),W.mergeSprites.forEach(function(e){console.log("foreach hitMerge arr s1:".concat(e.s1.aid,", x: ").concat(e.s1.x,", y: ").concat(e.s1.y,", value: ").concat(e.s1.value)),console.log("foreach hitMerge arr s2:".concat(e.s2.aid,", x: ").concat(e.s2.x,", y: ").concat(e.s2.y,", value: ").concat(e.s2.value)),H(e.s1,e.s2)}),W.mergeSprites=[]}function V(){if(!W.isInitRandomSprite){W.isInitRandomSprite=!0,console.log("数组长度：".concat(W.sprites.length));var e=y(0,w*w-1);W.randomSpriteIndex=e,console.log("初始随机位置：".concat(e)),e=J(e),console.log("去重后随机位置：".concat(e));var t=y(0,100)>W.probability?4:2;W.drawRectSprite(Object(u["a"])({},x(e,w),{value:t}))}}function J(e){var t=$(e);return console.log("是否位置重叠：".concat(t)),t?(e+=1,e%=w*w,J(e)):e}function $(e){var t=x(e,w),n=t.x,i=t.y;console.log("随机位置对应的x：".concat(n,", y: ").concat(i));var r=g(b+(W.spriteWidth+2*b)*n),o=g(b+(W.spriteWidth+2*b)*i);return W.sprites.find(function(e){return Math.abs(e.x-r)<1&&Math.abs(e.y-o)<1})}function T(){if(W.sprites.length===w*w){var e=d.a.sortBy(W.sprites,["y","x"]),t=e.find(function(t,n){return!!e[n+1]&&(t.y===e[n+1].y&&t.value===e[n+1].value)});return t||(e=d.a.sortBy(W.sprites,["x","y"]),t=e.find(function(t,n){return!!e[n+1]&&(t.x===e[n+1].x&&t.value===e[n+1].value)})),!t}return!1}function q(e){W.isMoving||(W.isMoving=!0,W.isInitRandomSprite=!1,W.moveDirection=e,W.moveSteps.push(e),W.sprites.forEach(function(e){return e.isNew=!1}),console.warn("方向：".concat(e)),W.isReserve&&(2===e||8===e)||!W.isReserve&&(4===e||16===e)?(W.sprites.reverse(),W.isReserve=!0):W.isReserve=!1,W.sprites.forEach(function(t){t.isNew=!1,t.x1=t.x,t.y1=t.y,2===e&&(t.vx=-S),4===e&&(t.vx=S),8===e&&(t.vy=-S),16===e&&(t.vy=S)}))}function H(e,t){console.log("hitMerge-s1: aid: ".concat(e.aid,", x: ").concat(e.x,", y: ").concat(e.y,", value: ").concat(e.value)),console.log("hitMerge-s2: aid: ".concat(t.aid,", x: ").concat(t.x,", y: ").concat(t.y,", value: ").concat(t.value)),N({x:e.x,y:e.y,value:2*e.value,v:{vx:e.vx,vy:e.vy}}),e.visible=!1,t.visible=!1;var n=M.stage.children[1].removeChild(e);console.log("removeChild-s1: aid: ".concat(n&&n.aid));var i=M.stage.children[1].removeChild(t);console.log("removeChild-s2: aid: ".concat(i&&i.aid))}function L(e){c(document.getElementById("pixi")).on("swipe",function(e){q(e.offsetDirection)}),W.left.release=function(){q(2)},W.right.release=function(){q(4)},W.down.release=function(){q(16)},W.up.release=function(){q(8)}}window.pixi=W;var z=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"game-over"},[n("div",{staticClass:"text"},[e._v("game over!")]),n("div",{staticClass:"btn",on:{click:e.newGame}},[e._v("new game")])])},K=[],Q={name:"GameOver",props:{},methods:{newGame:function(){h.width=document.getElementById("app").clientWidth,O.initView()}}},U=Q,X=(n("a40c"),n("2877")),Y=Object(X["a"])(U,z,K,!1,null,"72be6538",null);Y.options.__file="gameover.vue";var Z=Y.exports,ee={name:"Games-2048",components:{GameOver:Z},data:function(){return{data:h}},mounted:function(){h.width=document.getElementById("app").clientWidth,O.initView()},methods:{restart:function(){h.width=document.getElementById("app").clientWidth,O.initView()}}},te=ee,ne=(n("d599"),n("7f72"),Object(X["a"])(te,r,o,!1,null,"9cbec608",null));ne.options.__file="App.vue";var ie=ne.exports,re=n("9483");Object(re["a"])("".concat("/games/2048/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},cached:function(){console.log("Content has been cached for offline use.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}}),i["a"].config.productionTip=!1,new i["a"]({render:function(e){return e(ie)}}).$mount("#app")},d599:function(e,t,n){"use strict";var i=n("ed80"),r=n.n(i);r.a},d658:function(e,t,n){},ed80:function(e,t,n){},f651:function(e,t,n){}});
//# sourceMappingURL=app.f7ad16d3.js.map